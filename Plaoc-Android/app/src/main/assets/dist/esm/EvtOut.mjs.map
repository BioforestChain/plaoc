{"version":3,"file":"EvtOut.mjs","sources":["../../EvtOut.ts"],"sourcesContent":["/// <reference lib=\"dom\"/>\r\n\r\nexport class EvtOut<T> {\r\n  #controller!: ReadableStreamController<T>;\r\n  #stream = new ReadableStream<T>({\r\n    start: (controller) => (this.#controller = controller),\r\n  });\r\n  emit(data: T) {\r\n    this.#controller.enqueue(data);\r\n  }\r\n\r\n  async *#toAsyncGenerator(reader: ReadableStreamDefaultReader<T>) {\r\n    do {\r\n      const result = await reader.read();\r\n      if (result.done) {\r\n        break;\r\n      }\r\n      yield result.value!;\r\n    } while (true);\r\n  }\r\n  toAsyncGenerator(): Evt<T> {\r\n    const stream = this.#stream.tee()[1];\r\n    const reader = stream.getReader();\r\n    const ag = this.#toAsyncGenerator(reader);\r\n    const _return = ag.return;\r\n    ag.return = (value) => {\r\n      reader.cancel();\r\n      return _return.call(ag, value);\r\n    };\r\n\r\n    const _throw = ag.throw;\r\n    ag.throw = (e) => {\r\n      reader.cancel();\r\n      return _throw.call(ag, e);\r\n    };\r\n    return ag;\r\n  }\r\n}\r\nexport type Evt<T = unknown> = AsyncGenerator<T, void, void>;\r\n"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;AAEO;AAAA,MAAM,OAAU;AAAA,EAAhB;AASE;AARP;AACA,gCAAU,IAAI,eAAkB;AAAA,MAC9B,OAAO,CAAC,eAAgB,mBAAmB,aAAA;AAAA,IAAA,CAC5C;AAAA;AAAA,EACD,KAAK,MAAS;AACZ,uBAAA,aAAiB,QAAQ,IAAI;AAAA,EAC/B;AAAA,EAWA,mBAA2B;AACnB,UAAA,SAAS,mBAAa,SAAA,IAAM,EAAA;AAC5B,UAAA,SAAS,OAAO;AAChB,UAAA,KAAK,8DAAA,WAAuB;AAClC,UAAM,UAAU,GAAG;AAChB,OAAA,SAAS,CAAC,UAAU;AACrB,aAAO,OAAO;AACP,aAAA,QAAQ,KAAK,IAAI,KAAK;AAAA,IAAA;AAG/B,UAAM,SAAS,GAAG;AACf,OAAA,QAAQ,CAAC,MAAM;AAChB,aAAO,OAAO;AACP,aAAA,OAAO,KAAK,IAAI,CAAC;AAAA,IAAA;AAEnB,WAAA;AAAA,EACT;AACF;AAlCE;AACA;AAOO;AAAA,uCAAkB,QAAwC;AAC5D,KAAA;AACK,UAAA,SAAS,MAAM,OAAO;AAC5B,QAAI,OAAO,MAAM;AACf;AAAA,IACF;AACA,UAAM,OAAO;AAAA,EACN,SAAA;AACX;;"}